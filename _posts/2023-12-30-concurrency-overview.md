---
layout: post
title: 认识并发
---

## 并发
在计算机领域，`并发`指的是多个任务同时执行。这里的同时并非真正意义上的同时，实际表示的是在操作系统的调度下，多个任务快速交替执行。因为切换任务的速度快到人无法察觉出来（在linux系统，默认时间片是10ms），使得我们感觉多个任务在同时执行。
![并发](https://cdn.jsdelivr.net/gh/luyeeya/picx-images-hosting@master/programming/并发.2g1kmpeur3ok.png)

说到并发，另一个容易混淆的概念是并行。`并行`表示多个任务真正地同时在执行，需要多核CPU的支持，一个核心执行一个任务。
![并行](https://cdn.jsdelivr.net/gh/luyeeya/picx-images-hosting@master/programming/并行.1o2ohhy1plc0.png)

### 什么时候需要用到并发
1. 程序需要同时执行多个任务
2. 程序需要执行耗时的操作，如读写磁盘和网络传输
3. 程序需要实时相应用户的操作，如图形界面程序
4. 程序需要处理大量的数据，如机器学习

### 衡量并发能力的指标
- `TPS`：每秒能够执行的事务数（插入、修改、删除）
- `QPS`：每秒能够执行的查询数（查询）


### 如何支撑高并发
1. 高规格的硬件：CPU、内存、磁盘、网卡
2. 软件：
   - 正确使用多线程
   - 减少 IO 造成的影响：内存（不刷盘）、缓存（少刷盘）、异步刷盘（不实时刷盘）、分库分表（减少单次操作的IO数）
   - 单节点遇到瓶颈时，使用多个计算机组成一个分布式计算机

> 可以使用 Apache JMeter 压测


## 多线程技术
作用：提高计算资源利用率

### 进程和线程
- `进程`是操作系统调度和分配资源的单位，有独立的地址空间，上下文切换比较慢
- `线程`是操作系统可识别的最小执行单位，一个进程可以有多个线程，这些线程共享进程资源

### 线程的特征
- 异步
- 并行
